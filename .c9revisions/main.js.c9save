{"ts":1357596204441,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1357596772267,"patch":[[{"diffs":[[1,"function Tweet(originalText) {\r\n    this.originalText = originalText;\r\n}\r\n\r\n\r\nObject.defineProperty(Tweet, \"translatedText\", {\r\n    value: null,\r\n    writable: true,\r\n    enumerable: true,\r\n    configurable: true\r\n});\r\n\r\nObject.defineProperties(Tweet.prototype, {\r\n    isTranslated: {\r\n        value: function isTranslated() {\r\n            return this.translatedText != null;\r\n        }\r\n    }\r\n});\r\n\r\n\r\nvar ulListNodes = Array.prototype.slice.call(document.getElementsByClassName('js-actions'));\r\nvar lookup = [];\r\n\r\n\r\nfor (var i = 0; i <= ulListNodes.length - 1; i++) {\r\n    var ul = ulListNodes[i];\r\n    appendTranslateNode(ul);\r\n}\r\n\r\nfunction appendTranslateNode(ul) {\r\n    var tweetNode = ul.parentNode.parentNode.parentNode;\r\n    var tweetId = tweetNode.dataset.tweetId;\r\n\r\n    if (!lookup.hasOwnProperty(tweetId)) {\r\n        var a = document.createElement('a');\r\n        a.href = '#';\r\n        a.id = 'translate_' + tweetId;\r\n        a.dataset.tweetIdentifier = tweetId;\r\n        a.addEventListener(\"click\", translateTweetText);\r\n        var text1 = document.createTextNode('translate');\r\n        var li = document.createElement('li');\r\n        a.appendChild(text1);\r\n        li.appendChild(a);\r\n        ul.appendChild(li);\r\n        \r\n        \r\n        var a = document.createElement('a');\r\n        a.href = '#';\r\n        a.id = 'revert_' + tweetId;\r\n        a.dataset.tweetIdentifier = tweetId;\r\n        a.style.display = 'none';\r\n        a.addEventListener(\"click\", revertTweetText);\r\n        var text1 = document.createTextNode('original text');\r\n        var li = document.createElement('li');\r\n        a.appendChild(text1);\r\n        li.appendChild(a);\r\n        ul.appendChild(li);\r\n\r\n        var tweetText = getTweetText(tweetId);\r\n        lookup[tweetId] = new Tweet(tweetText);\r\n    }\r\n}\r\n\r\nfunction translateTweetText(evt) {\r\n\r\n    var tweetId = evt.target.dataset.tweetIdentifier;\r\n    if (lookup.hasOwnProperty(tweetId) && lookup[tweetId].isTranslated()) {\r\n        console.log(\"cache lookup...\");\r\n        var tweet = lookup[tweetId];\r\n        setTweetText(tweetId, tweet.translatedText);\r\n        \r\n        document.getElementById('translate_' + tweetId).style.display = 'none';\r\n        document.getElementById('revert_' + tweetId).style.display = '';\r\n    } else {\r\n        console.log(\"api lookup...\");\r\n        var tweetText = getTweetText(tweetId);\r\n        translateText(tweetText, tweetId);\r\n    }\r\n    \r\n}\r\n\r\nfunction revertTweetText(evt) {\r\n    var tweetId = evt.target.dataset.tweetIdentifier;\r\n    if (!lookup.hasOwnProperty(tweetId)) {\r\n        console.log(\"An error occurred.\");\r\n        return;\r\n    }\r\n    \r\n    var tweet = lookup[tweetId];\r\n    setTweetText(tweetId, tweet.originalText);\r\n    document.getElementById('translate_' + tweetId).style.display = ''; \r\n    document.getElementById('revert_' + tweetId).style.display = 'none';\r\n}\r\n\r\nfunction getTweetText(tweetId) {\r\n    var tweet = document.querySelector('[data-tweet-id=\"' + tweetId + '\"]');\r\n    var para = tweet.querySelector('p.js-tweet-text');\r\n    return para.firstChild.textContent;\r\n}\r\n\r\nfunction setTweetText(tweetId, text) {\r\n    var tweet = document.querySelector('[data-tweet-id=\"' + tweetId + '\"]');\r\n    var para = tweet.querySelector('p.js-tweet-text');\r\n    para.textContent = text;\r\n}\r\n\r\n\r\nfunction handleTranslationCallback(message){\r\n    var tweetId = message.tweetId;  \r\n    var translatedTweetText = message.translatedTweetText;  \r\n    \r\n    var tweet = lookup[tweetId];\r\n    tweet.translatedText = translatedTweetText;\r\n    setTweetText(tweetId, translatedTweetText);\r\n    \r\n    document.getElementById('translate_' + tweetId).style.display = 'none';\r\n    document.getElementById('revert_' + tweetId).style.display = '';\r\n}\r\n\r\n"]],"start1":0,"start2":0,"length1":0,"length2":3743}]],"length":3743,"saved":false}
{"ts":1357596883933,"patch":[[{"diffs":[[0,"dText !="],[-1,""],[0,""],[1,"="],[0," null;\r\n"]],"start1":361,"start2":361,"length1":16,"length2":17},{"diffs":[[0,"        var text"],[-1,"1"],[0,""],[1,""],[0," = document.crea"]],"start1":1038,"start2":1038,"length1":33,"length2":32},{"diffs":[[0,"appendChild(text"],[-1,"1"],[0,""],[1,""],[0,");\r\n        li.a"]],"start1":1154,"start2":1154,"length1":33,"length2":32},{"diffs":[[0," \r\n        var a"],[1,"1"],[0," = document.crea"]],"start1":1248,"start2":1248,"length1":32,"length2":33},{"diffs":[[0,"'a');\r\n        a"],[1,"1"],[0,".href = '#';\r\n  "]],"start1":1291,"start2":1291,"length1":32,"length2":33},{"diffs":[[0,";\r\n        a"],[1,"1"],[0,".id = 'rever"]],"start1":1319,"start2":1319,"length1":24,"length2":25},{"diffs":[[0,"etId;\r\n        a"],[1,"1"],[0,".dataset.tweetId"]],"start1":1353,"start2":1353,"length1":32,"length2":33},{"diffs":[[0,"       a"],[1,"1"],[0,".style.d"]],"start1":1408,"start2":1408,"length1":16,"length2":17},{"diffs":[[0,"one';\r\n        a"],[1,"1"],[0,".addEventListene"]],"start1":1436,"start2":1436,"length1":32,"length2":33},{"diffs":[[0,"\r\n        var li"],[1,"1"],[0," = document.crea"]],"start1":1560,"start2":1560,"length1":32,"length2":33},{"diffs":[[0,"li');\r\n        a"],[1,"1"],[0,".appendChild(tex"]],"start1":1604,"start2":1604,"length1":32,"length2":33},{"diffs":[[0,"t1);\r\n        li"],[1,"1"],[0,".appendChild(a);"]],"start1":1637,"start2":1637,"length1":32,"length2":33},{"diffs":[[0,"i1.appendChild(a"],[1,"1"],[0,");\r\n        ul.a"]],"start1":1652,"start2":1652,"length1":32,"length2":33},{"diffs":[[0,"pendChild(li"],[1,"1"],[0,");\r\n\r\n      "]],"start1":1686,"start2":1686,"length1":24,"length2":25},{"diffs":[[0,"\n       "],[1," //"],[0," transla"]],"start1":2382,"start2":2382,"length1":16,"length2":19},{"diffs":[[0," tweetId);\r\n"],[1,"        // TODO: Send tweet message request\r\n"],[0,"    }\r\n    \r"]],"start1":2418,"start2":2418,"length1":24,"length2":69}]],"length":3801,"saved":false}
